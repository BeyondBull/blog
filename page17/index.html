<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      Joshua Lande &middot; Data Science, Apache Pig, Hadoop, Blogging, Tweets, Astrophysics
    
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="/public/css/poole.css">
  <link rel="stylesheet" href="/public/css/syntax.css">

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/apple-touch-icon-144-precomposed.png">
                                 <link rel="shortcut icon" href="/public/favicon.ico">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">
</head>

  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-47674613-1', 'joshualande.com');
  ga('send', 'pageview');

</script>


  <body>

    <div class="container content">
      <div class="masthead">
        <h3 class="masthead-title">
          <a href="/" title="Home">Joshua Lande</a>

          
              &nbsp;&nbsp;&nbsp;<small><a href="/about/">About</a></small>
          
              &nbsp;&nbsp;&nbsp;<small><a href="/archive/">Archive</a></small>
          
              &nbsp;&nbsp;&nbsp;<small><a href="/atom.xml">Feed</a></small>
          

        </h3>
      </div>

      <div class="posts">
  
  <div class="post">
    <h1 class="post-title">
      <a href="/pointlike-fitting-package">
        The pointlike Maximum-likelihood Fitting Package For Analysis Fermi-LAT Data
      </a>
    </h1>

    <span class="post-date">01 Feb 2013</span>

    <p><img src="/assets/gamma_cygni_pointlike-940x935.jpg" alt="The Gamma-cygni SNR observed by Fermi. This image was created in pointlike and is from http://arxiv.org/abs/1207.0027." /></p>

<p>During graduate school, I was involved with the development of pointlike, a package for fitting data observed by the <a href="http://fermi.gsfc.nasa.gov">Fermi Gamma-ray space telescope</a>.</p>

<h2 id="design">Design</h2>

<p>Pointlike was designed from the ground up with flexibility in mind:</p>

<ul>
  <li>high-level code written in python with an object-oriented design.</li>
  <li>Interface with underlying C++ libraries to handle <a href="http://healpix.jpl.nasa.gov">HEALPix</a> and <a href="http://fits.gsfc.nasa.gov">fits files</a>. These libraries were wrapped with <a href="http://www.swig.org">SWIG</a></li>
  <li>Leverage as much as possible <a href="http://www.numpy.org">numpy</a>, <a href="http://www.scipy.org">scipy</a>, <a href="http://matplotlib.org">matplotlib</a>, and <a href="http://leejjoon.github.com/pywcsgrid2">pywcsgrid2</a>.</li>
  <li>python interface allows great flexibility and adaptability.</li>
</ul>

<h2 id="interface">Interface</h2>

<p>The objects and functions described below have a variety of parameters that modify their behavior. The easist way to explore pointlike’s features is interactivly in ipython using the <a href="http://ipython.org/ipython-doc/dev/interactive/tutorial.html#exploring-your-objects">question mark functionality</a>:</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="err">$</span> <span class="n">ipython</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="n">roi</span><span class="o">.</span><span class="n">print_summary</span><span class="err">?</span>
<span class="n">Type</span><span class="p">:</span>             <span class="n">instancemethod</span>
<span class="n">Base</span> <span class="n">Class</span><span class="p">:</span>       <span class="o">&lt;</span><span class="nb">type</span> <span class="s">&#39;instancemethod&#39;</span><span class="o">&gt;</span>
<span class="n">String</span> <span class="n">Form</span><span class="p">:</span>   <span class="n">File</span><span class="p">:</span>             <span class="o">/</span><span class="n">nfs</span><span class="o">/</span><span class="n">farm</span><span class="o">/</span><span class="n">g</span><span class="o">/</span><span class="n">glast</span><span class="o">/</span><span class="n">u35</span><span class="o">/</span><span class="n">ReleaseManagerBuild</span><span class="o">/</span><span class="n">redhat5</span><span class="o">-</span><span class="n">x86_64</span><span class="o">-</span><span class="mf">64.</span><span class="o">..</span>
<span class="n">Definition</span><span class="p">:</span>       <span class="n">roi</span><span class="o">.</span><span class="n">print_summary</span><span class="p">(</span><span class="n">roi</span><span class="p">,</span> <span class="n">sdir</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">galactic</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">maxdist</span><span class="o">=</span><span class="mf">5.</span><span class="o">..</span>
<span class="n">Docstring</span><span class="p">:</span>
    <span class="n">formatted</span> <span class="n">table</span> <span class="n">point</span> <span class="n">sources</span> <span class="n">positions</span> <span class="ow">and</span> <span class="n">parameter</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">ROI</span><span class="p">,</span>
        <span class="n">followed</span> <span class="n">by</span> <span class="n">summary</span> <span class="n">of</span> <span class="n">diffuse</span> <span class="n">names</span><span class="p">,</span> <span class="n">parameters</span> <span class="n">values</span><span class="o">.</span>
        <span class="n">values</span> <span class="n">are</span> <span class="n">followed</span> <span class="n">by</span> <span class="n">a</span> <span class="n">character</span> <span class="n">to</span> <span class="n">indicate</span> <span class="n">status</span><span class="p">:</span>
            <span class="n">blank</span><span class="p">:</span> <span class="n">fixed</span>
            <span class="err">?</span>      <span class="n">sigma</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="ow">not</span> <span class="n">fit</span> <span class="n">yet</span>
            <span class="err">!</span>      <span class="n">relative</span> <span class="n">error</span><span class="o">&lt;</span><span class="mf">0.1</span>
            <span class="o">*</span>      <span class="n">otherwise</span>
    <span class="n">Parameters</span>
    <span class="o">----------</span>
         <span class="n">sdir</span> <span class="p">:</span> <span class="n">SkyDir</span><span class="p">,</span> <span class="n">optional</span><span class="p">,</span> <span class="n">default</span> <span class="bp">None</span> <span class="k">for</span> <span class="n">center</span>
               <span class="k">for</span> <span class="n">center</span><span class="p">:</span> <span class="n">default</span> <span class="n">will</span> <span class="n">be</span> <span class="n">the</span> <span class="n">first</span> <span class="n">source</span>
         <span class="n">galactic</span> <span class="p">:</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">optional</span><span class="p">,</span> <span class="n">default</span> <span class="bp">False</span>
             <span class="nb">set</span> <span class="n">true</span> <span class="k">for</span> <span class="n">l</span><span class="p">,</span><span class="n">b</span>
         <span class="n">maxdist</span> <span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">optional</span><span class="p">,</span> <span class="n">default</span> <span class="mi">5</span>
             <span class="n">radius</span> <span class="ow">in</span> <span class="n">degrees</span>
<span class="o">...</span></code></pre></div>

<h2 id="build-the-roi">Build the ROI</h2>

<p>To perform a Fermi analysis, first create a DataSpecification object. This defines the Fermi data that will be used:</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">uw.like.pointspec</span> <span class="kn">import</span> <span class="n">DataSpecification</span>
<span class="n">ds</span><span class="o">=</span><span class="n">DataSpecification</span><span class="p">(</span><span class="n">binfile</span><span class="o">=</span><span class="s">&quot;binned.fits&quot;</span><span class="p">,</span>
                     <span class="n">ltcube</span><span class="o">=</span><span class="s">&quot;ltcube.fits&quot;</span><span class="p">,</span>
                     <span class="n">ft1files</span><span class="o">=</span><span class="p">[</span><span class="s">&quot;ft1_part1.fits&quot;</span><span class="p">,</span><span class="s">&quot;ft1_part2.fits&quot;</span><span class="p">],</span>
                     <span class="n">ft2files</span><span class="o">=</span><span class="s">&quot;ft2.fits&quot;</span><span class="p">)</span></code></pre></div>

<p>Next, set the binning and the <a href="http://www.slac.stanford.edu/exp/glast/groups/canda/lat_Performance.htm">instrument response function</a> with the SpectralAnalysis object:</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="c">## First, define the center of your desired analysis region</span>
<span class="kn">from</span> <span class="nn">skymaps</span> <span class="kn">import</span> <span class="n">SkyDir</span>
<span class="n">center</span><span class="o">=</span><span class="n">SkyDir</span><span class="p">(</span><span class="mf">086.1111</span><span class="p">,</span><span class="o">-</span><span class="mf">38.1838</span><span class="p">,</span><span class="n">SkyDir</span><span class="o">.</span><span class="n">GALACTIC</span><span class="p">)</span>

<span class="kn">from</span> <span class="nn">uw.like.pointspec</span> <span class="kn">import</span> <span class="n">SpectralAnalysis</span>
<span class="n">sa</span><span class="o">=</span><span class="n">SpectralAnalysis</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span>
                    <span class="n">binsperdec</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
                    <span class="n">emin</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
                    <span class="n">emax</span><span class="o">=</span><span class="mi">100000</span><span class="p">,</span>
                    <span class="n">irf</span><span class="o">=</span><span class="s">&quot;P6_V3_DIFFUSE&quot;</span><span class="p">,</span>
                    <span class="n">roi_dir</span><span class="o">=</span><span class="n">center</span><span class="p">,</span>
                    <span class="n">maxROI</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
                    <span class="n">minROI</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span></code></pre></div>

<p>Assuming you have a <a href="http://fermi.gsfc.nasa.gov/ssc/data/analysis/scitools/source_models.html">gtlike-style XML file</a> defining the sky model, create the region of interest (ROI):</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">roi</span><span class="o">=</span><span class="n">sa</span><span class="o">.</span><span class="n">roi</span><span class="p">(</span><span class="n">xmlfile</span><span class="o">=</span><span class="s">&quot;model.xml&quot;</span><span class="p">)</span></code></pre></div>

<p>This ROI object can be used to perform many common Fermi analyses.</p>

<h2 id="basic-fitting">Basic Fitting</h2>

<p>To print a summary of the sources in your model:</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">roi</span><span class="o">.</span><span class="n">print_summary</span><span class="p">()</span></code></pre></div>

<p>This produces the output</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="o">----------------------------------------------------------------------------</span>
         <span class="n">Nearby</span> <span class="n">sources</span> <span class="n">within</span> <span class="mf">5.0</span> <span class="n">degrees</span>
<span class="n">name</span>               <span class="n">dist</span>       <span class="n">l</span>       <span class="n">b</span>  <span class="n">TS</span>  <span class="n">flux8</span>   <span class="n">index</span>  <span class="n">beta</span>    <span class="n">cutoff</span>
<span class="mi">2</span><span class="n">FGL</span> <span class="n">J1837</span><span class="o">.</span><span class="mi">3</span><span class="o">-</span><span class="mo">0700</span><span class="n">c</span>  <span class="mf">0.2</span>  <span class="mf">25.084</span>   <span class="mf">0.132</span>  <span class="mi">48</span>   <span class="mf">2.08</span><span class="o">*</span>  <span class="mf">1.60</span><span class="o">*</span>
<span class="mi">2</span><span class="n">FGL</span> <span class="n">J1836</span><span class="o">.</span><span class="mi">8</span><span class="o">-</span><span class="mo">0623</span><span class="n">c</span>  <span class="mf">0.6</span>  <span class="mf">25.569</span>   <span class="mf">0.324</span>  <span class="mi">13</span>   <span class="mf">0.45</span><span class="o">*</span>  <span class="mf">0.02</span><span class="o">*</span>  <span class="mf">0.22</span><span class="o">*</span>   <span class="mf">100.36</span><span class="o">*</span>
<span class="mi">2</span><span class="n">FGL</span> <span class="n">J1834</span><span class="o">.</span><span class="mi">7</span><span class="o">-</span><span class="mo">0705</span><span class="n">c</span>  <span class="mf">0.7</span>  <span class="mf">24.715</span>   <span class="mf">0.503</span>  <span class="mi">46</span>  <span class="mf">33.11</span><span class="o">*</span>  <span class="mf">2.35</span><span class="o">*</span>
<span class="mi">2</span><span class="n">FGL</span> <span class="n">J1839</span><span class="o">.</span><span class="mi">3</span><span class="o">-</span><span class="mo">055</span><span class="mi">8</span><span class="n">c</span>  <span class="mf">1.0</span>  <span class="mf">26.080</span>   <span class="mf">0.229</span>  <span class="mi">21</span>   <span class="mf">2.29</span><span class="o">*</span>  <span class="mf">0.10</span><span class="o">*</span>  <span class="mf">0.56</span><span class="o">*</span>   <span class="mf">553.51</span><span class="o">*</span>
<span class="mi">2</span><span class="n">FGL</span> <span class="n">J1834</span><span class="o">.</span><span class="mi">3</span><span class="o">-</span><span class="mi">0848</span>   <span class="mf">2.0</span>  <span class="mf">23.143</span>  <span class="o">-</span><span class="mf">0.242</span>  <span class="mi">18</span>   <span class="mf">1.45</span><span class="o">*</span>  <span class="mf">0.45</span><span class="o">*</span>  <span class="mf">0.19</span><span class="o">*</span>    <span class="mf">74.40</span><span class="o">*</span>
<span class="mi">2</span><span class="n">FGL</span> <span class="n">J1841</span><span class="o">.</span><span class="mi">2</span><span class="o">-</span><span class="mo">045</span><span class="mi">9</span><span class="n">c</span>  <span class="mf">2.2</span>  <span class="mf">27.323</span>  <span class="o">-</span><span class="mf">0.011</span>   <span class="mi">1</span>  <span class="mf">10.52</span>   <span class="mf">2.47</span>   <span class="mf">0.22</span>   <span class="mf">1940.48</span>
<span class="o">----------------------------------------------------------------------------</span>
        <span class="n">Diffuse</span> <span class="n">sources</span>
<span class="o">----------------------------------------------------------------------------</span>
<span class="n">ring_2year_P76_v0</span><span class="o">.</span><span class="n">fits</span>      <span class="mf">0.74</span><span class="err">!</span>      <span class="mf">0.90</span><span class="err">!</span>
<span class="n">isotrop_2year_P76_source_v0</span><span class="o">.</span><span class="n">txt</span>      <span class="mf">0.00</span><span class="o">*</span>
<span class="o">----------------------------------------------------------------------------</span>
<span class="o">-&gt;</span> <span class="n">Total</span> <span class="p">(</span><span class="ow">not</span> <span class="n">negative</span><span class="p">)</span> <span class="n">logLikelihood</span> <span class="o">=</span>  <span class="o">-</span><span class="mf">58282.6030786</span></code></pre></div>

<p>To perform a spectral fit:</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">roi</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">use_gradient</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span></code></pre></div>

<p>This produces the output</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="o">.....</span> <span class="n">performing</span> <span class="n">likelihood</span> <span class="n">maximization</span> <span class="o">...</span> <span class="n">Optimization</span> <span class="n">terminated</span>
<span class="n">Current</span> <span class="n">function</span> <span class="n">value</span><span class="p">:</span> <span class="o">-</span><span class="mf">259556.745008</span> <span class="n">Iterations</span><span class="p">:</span> <span class="mi">229</span>
<span class="n">Function</span> <span class="n">evaluations</span><span class="p">:</span> <span class="mi">379</span>
<span class="n">Function</span> <span class="n">value</span> <span class="n">at</span> <span class="n">minimum</span><span class="p">:</span> <span class="o">-</span><span class="mf">259556.75</span>
<span class="n">Attempting</span> <span class="n">to</span> <span class="n">invert</span> <span class="n">full</span> <span class="n">hessian</span> <span class="o">...</span></code></pre></div>

<p>To compute the <a href="http://en.wikipedia.org/wiki/Test_statistic">test statistic</a> for the detection of the source:</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">ts</span><span class="o">=</span><span class="n">roi</span><span class="o">.</span><span class="n">TS</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="s">&quot;name&quot;</span><span class="p">)</span></code></pre></div>

<p>To compute the log likelihood:</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">ll</span><span class="o">=-</span><span class="mi">1</span><span class="o">*</span><span class="n">roi</span><span class="o">.</span><span class="n">logLikelihood</span><span class="p">(</span><span class="n">roi</span><span class="o">.</span><span class="n">parameters</span><span class="p">())</span></code></pre></div>

<p>To fit the position of a source:</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">roi</span><span class="o">.</span><span class="n">localize</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="s">&quot;source_name&quot;</span><span class="p">,</span> <span class="n">update</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span></code></pre></div>

<p>update=True causes the position of the source to be updated after the position is fit.</p>

<p>To print the elliptical fit uncertainty:</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">roi</span><span class="o">.</span><span class="n">print_ellipse</span><span class="p">()</span></code></pre></div>

<p>This produces the output</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">ra</span>     <span class="n">dec</span>     <span class="n">a</span>     <span class="n">b</span>     <span class="n">ang</span>   <span class="n">qual</span>
  <span class="mf">258.008</span> <span class="o">-</span><span class="mf">39.635</span> <span class="mf">0.061</span> <span class="mf">0.031</span> <span class="mf">25.5596</span> <span class="mf">7.7114</span>   <span class="mf">50.65</span></code></pre></div>

<p>The ellipse’s major axis is a, minor axis is b, orientation angle is ang (measured east of celestial north), and elliptical fit quality is qual.</p>

<p>To get the ellipse values:</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">ellipse</span><span class="o">=</span><span class="n">roi</span><span class="o">.</span><span class="n">get_ellipse</span><span class="p">()</span></code></pre></div>

<h2 id="plotting">Plotting</h2>
<p>Making plots in pointlike is easy.</p>

<p>To plot the spectral energy distribution:</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">roi</span><span class="o">.</span><span class="n">plot_sed</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="s">&quot;name&quot;</span><span class="p">,</span><span class="n">filename</span><span class="o">=</span><span class="s">&#39;sed.pdf&#39;</span><span class="p">)</span></code></pre></div>

<p><img src="/assets/pointlike_sed.png" alt="An SED computed using pointlike." /></p>

<p>To make a residual test statistic map:</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">roi</span><span class="o">.</span><span class="n">plot_tsmap</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="s">&#39;tsmap.pdf&#39;</span><span class="p">)</span></code></pre></div>

<p><img src="/assets/pointlike_tsmap.png" alt="A TSmap computed using pointlike." /></p>

<p>To plot a model counts map, counts map, and residual counts map:</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">roi</span><span class="o">.</span><span class="n">plot_counts_map</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="s">&#39;counts.pdf&#39;</span><span class="p">)</span></code></pre></div>

<p><img src="/assets/pointlike_counts_map.png" alt="A counts map computed using pointlike." /></p>

<p>To plot a smoothed diffuse-emission-subtracted counts map:</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">roi</span><span class="o">.</span><span class="n">plot_sources</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="s">&#39;name&#39;</span><span class="p">,</span>
                 <span class="n">filename</span><span class="o">=</span><span class="s">&#39;source.png&#39;</span><span class="p">,</span>
                 <span class="n">kernel_rad</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span></code></pre></div>

<p><img src="/assets/pointlike_smoothed_counts_map.png" alt="A smoothed counts map computing using pointlike." /></p>

<h2 id="pointlike-without-xml">Pointlike without XML</h2>

<p>You can build a pointlike ROI without a [gtlike-style XML file] (http://fermi.gsfc.nasa.gov/ssc/data/analysis/scitools/source_models.html) by programmatically specifying the background model and source catalog:</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">uw.like.roi_catalogs</span> <span class="kn">import</span> <span class="n">Catalog2FGL</span>
<span class="kn">from</span> <span class="nn">uw.like.pointspec_helpers</span> <span class="kn">import</span> <span class="n">get_default_diffuse</span>
<span class="n">roi</span> <span class="o">=</span> <span class="n">sa</span><span class="o">.</span><span class="n">roi</span><span class="p">(</span>
  <span class="c"># standard gal + iso diffuse</span>
  <span class="n">diffuse_sources</span><span class="o">=</span><span class="n">get_default_diffuse</span><span class="p">(</span>
    <span class="n">diffdir</span><span class="o">=</span><span class="s">&#39;/path/to/diffuse/&#39;</span><span class="p">,</span>
    <span class="n">gfile</span><span class="o">=</span><span class="s">&#39;ring_24month_P76_v1.fits&#39;</span><span class="p">,</span>
    <span class="n">ifile</span><span class="o">=</span><span class="s">&#39;isotrop_21month_P76_source_v2.txt&#39;</span><span class="p">),</span>

  <span class="c"># load in 2FGL automatically</span>
  <span class="n">catalogs</span> <span class="o">=</span> <span class="n">Catalog2FGL</span><span class="p">(</span><span class="s">&quot;gll_psc_v05.fit&quot;</span><span class="p">,</span>
    <span class="n">latextdir</span><span class="o">=</span><span class="s">&#39;gll_psc_v05_templates&#39;</span><span class="p">,</span>
    <span class="n">free_radius</span><span class="o">=</span><span class="mi">2</span><span class="p">),</span>

  <span class="c"># add additonal point sources</span>
  <span class="n">point_sources</span><span class="o">=</span><span class="p">[</span><span class="o">...</span><span class="p">],</span>
<span class="p">)</span></code></pre></div>

<h2 id="modifying-the-sky-model">Modifying the Sky Model</h2>
<p>Pointlike exposes functionality to easily modify the sky model of an ROI.</p>

<p>To create a new spectral model:</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">uw.like.Models</span> <span class="kn">import</span> <span class="o">*</span>
<span class="n">PowerLaw</span><span class="p">(</span><span class="n">norm</span><span class="o">=</span><span class="mf">1e-11</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">e0</span><span class="o">=</span><span class="mf">1e3</span><span class="p">)</span>
<span class="n">PowerLawFlux</span><span class="p">(</span><span class="n">int_norm</span><span class="o">=</span><span class="mf">1e-7</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span><span class="n">emin</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">emax</span><span class="o">=</span><span class="mf">1e6</span><span class="p">)</span>
<span class="n">BrokenPowerLaw</span><span class="p">(</span><span class="n">norm</span><span class="o">=</span><span class="mf">1e-11</span><span class="p">,</span> <span class="n">index_1</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span>
               <span class="n">index_2</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">e_break</span><span class="o">=</span><span class="mf">1e3</span><span class="p">)</span>
<span class="n">BrokenPowerLawFlux</span><span class="p">(</span><span class="n">int_flux</span><span class="o">=</span><span class="mf">1e-7</span><span class="p">,</span> <span class="n">index_1</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span>
                   <span class="n">index_2</span><span class="o">=</span><span class="mf">2.0</span> <span class="p">,</span><span class="n">e_break</span><span class="o">=</span><span class="mf">1e3</span><span class="p">,</span>
                   <span class="n">emin</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">emax</span><span class="o">=</span><span class="mf">1e6</span><span class="p">)</span>
<span class="n">BrokenPowerLawCutoff</span><span class="p">(</span><span class="n">norm</span><span class="o">=</span><span class="mf">1e-11</span><span class="p">,</span><span class="n">index_1</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                     <span class="n">index_2</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">e_break</span><span class="o">=</span><span class="mf">1e3</span><span class="p">)</span>
<span class="n">SmoothBrokenPowerLaw</span><span class="p">(</span><span class="n">norm</span><span class="o">=</span><span class="mf">1e-11</span><span class="p">,</span><span class="n">index_1</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span>
                     <span class="n">index_2</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">e_break</span><span class="o">=</span><span class="mf">1e3</span><span class="p">,</span><span class="n">beta</span><span class="o">=.</span><span class="mi">1</span><span class="p">)</span>
<span class="n">DoublePowerLaw</span><span class="p">(</span><span class="n">norm</span><span class="o">=</span><span class="mf">5e-12</span><span class="p">,</span> <span class="n">index_1</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
               <span class="n">index_2</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">ratio</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">LogParabola</span><span class="p">(</span><span class="n">norm</span><span class="o">=</span><span class="mf">1e-11</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">beta</span><span class="o">=</span><span class="mf">1e-5</span><span class="p">,</span> <span class="n">e_break</span><span class="o">=</span><span class="mf">2e3</span><span class="p">)</span>
<span class="n">ExpCutoff</span><span class="p">(</span><span class="n">norm</span><span class="o">=</span><span class="mf">1e-11</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">cutoff</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="mf">2e3</span><span class="p">)</span>
<span class="n">ExpCutoffPlusPL</span><span class="p">(</span><span class="n">norm1</span><span class="o">=</span><span class="mf">1e-11</span><span class="p">,</span><span class="n">index1</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">cutoff1</span><span class="o">=</span><span class="mf">2e3</span><span class="p">,</span>
                <span class="n">norm2</span><span class="o">=</span><span class="mf">1e-12</span><span class="p">,</span><span class="n">index2</span><span class="o">=</span><span class="mf">1.5</span><span class="p">)</span>
<span class="n">AllCutoff</span><span class="p">(</span><span class="n">norm</span><span class="o">=</span><span class="mf">1e-11</span><span class="p">,</span><span class="n">cutoff</span><span class="o">=</span><span class="mf">1e3</span><span class="p">)</span>
<span class="n">PLSuperExpCutoff</span><span class="p">(</span><span class="n">norm</span><span class="o">=</span><span class="mf">1e-11</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">cutoff</span><span class="o">=</span><span class="mf">2e3</span><span class="p">,</span><span class="n">b</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">Constant</span><span class="p">(</span><span class="n">scale</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span></code></pre></div>

<p>To create a new point source:</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">uw.like.pointspec_helpers</span> \
    <span class="kn">import</span> <span class="n">PointSource</span>
<span class="kn">from</span> <span class="nn">uw.like.Models</span> <span class="kn">import</span> <span class="n">PowerLaw</span>

<span class="n">ps</span><span class="o">=</span><span class="n">PointSource</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;source&#39;</span><span class="p">,</span>
    <span class="n">skydir</span><span class="o">=</span><span class="n">SkyDir</span><span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">SkyDir</span><span class="o">.</span><span class="n">GALACTIC</span><span class="p">),</span>
    <span class="n">model</span><span class="o">=</span><span class="n">PowerLaw</span><span class="p">(</span><span class="n">norm</span><span class="o">=</span><span class="mf">1e-11</span><span class="p">,</span>
                   <span class="n">index</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span></code></pre></div>

<p>To add or delete a point source in the ROI:</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">roi</span><span class="o">.</span><span class="n">add_source</span><span class="p">(</span><span class="n">ps</span><span class="p">)</span>
<span class="n">roi</span><span class="o">.</span><span class="n">del_source</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="s">&#39;name&#39;</span><span class="p">)</span></code></pre></div>

<p>To modify the spectral model or position of a source in the ROI:</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">roi</span><span class="o">.</span><span class="n">modify</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="s">&#39;name&#39;</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="n">PowerLaw</span><span class="p">(</span><span class="o">...</span><span class="p">))</span>
<span class="n">roi</span><span class="o">.</span><span class="n">modify</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="s">&#39;name&#39;</span><span class="p">,</span> <span class="n">skydir</span><span class="o">=</span><span class="n">SkyDir</span><span class="p">(</span><span class="o">...</span><span class="p">))</span></code></pre></div>

<p>To zero or unzero a source:</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">roi</span><span class="o">.</span><span class="n">zero_source</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="s">&#39;source&#39;</span><span class="p">)</span>
<span class="n">roi</span><span class="o">.</span><span class="n">unzero_source</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="s">&#39;source&#39;</span><span class="p">)</span></code></pre></div>

<p>To freeze or unfreeze a source:</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">roi</span><span class="o">.</span><span class="n">modify</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="s">&#39;source_name&#39;</span><span class="p">,</span><span class="n">free</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
<span class="n">roi</span><span class="o">.</span><span class="n">modify</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="s">&#39;source_name&#39;</span><span class="p">,</span><span class="n">free</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span></code></pre></div>

<h2 id="iterative-analyses">Iterative Analyses</h2>
<p>One of the major benefits of pointlike is that the underlying functions can be used in more complicated programs.</p>

<p>For example, to delete all insignificant sources:</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="n">degrees</span>
<span class="k">for</span> <span class="n">source</span> <span class="ow">in</span> <span class="n">roi</span><span class="o">.</span><span class="n">get_sources</span><span class="p">():</span>
    <span class="k">if</span> <span class="n">roi</span><span class="o">.</span><span class="n">TS</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="n">source</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">9</span><span class="p">:</span>
        <span class="n">roi</span><span class="o">.</span><span class="n">del_source</span><span class="p">(</span><span class="n">source</span><span class="p">)</span></code></pre></div>

<p>Or to localize all sources within 2 degrees of the center of the ROI:</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="n">degrees</span>
<span class="k">for</span> <span class="n">source</span> <span class="ow">in</span> <span class="n">roi</span><span class="o">.</span><span class="n">get_sources</span><span class="p">():</span>
  <span class="n">sd</span><span class="o">=</span><span class="n">source</span><span class="o">.</span><span class="n">skydir</span>
  <span class="n">dist</span><span class="o">=</span><span class="n">degrees</span><span class="p">(</span><span class="n">sd</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="n">roi</span><span class="o">.</span><span class="n">roi_dir</span><span class="p">))</span>
  <span class="k">if</span> <span class="n">dist</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
    <span class="n">roi</span><span class="o">.</span><span class="n">localize</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="n">source</span><span class="p">,</span><span class="n">update</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span></code></pre></div>

<h2 id="file-inputoutput">File input/output</h2>
<p>There are several methods for getting data out of pointlike:</p>

<p>To save a <a href="http://fermi.gsfc.nasa.gov/ssc/data/analysis/scitools/source_models.html">gtlike-style XML file</a>:</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">roi</span><span class="o">.</span><span class="n">toXML</span><span class="p">(</span><span class="s">&#39;output.xml&#39;</span><span class="p">)</span></code></pre></div>

<p>To make a gtlike-style results file:</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">roi</span><span class="o">.</span><span class="n">toResults</span><span class="p">(</span><span class="s">&#39;output.rat&#39;</span><span class="p">)</span></code></pre></div>

<p>To save out a <a href="http://hea-www.harvard.edu/RD/ds9/site/Home.html">ds9</a>-style region file:</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">roi</span><span class="o">.</span><span class="n">toRegion</span><span class="p">(</span><span class="s">&#39;output.reg&#39;</span><span class="p">)</span></code></pre></div>

<p>To save the entire ROI to a file:</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">roi</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s">&#39;roi.dat&#39;</span><span class="p">)</span></code></pre></div>

<p>To recreate the ROI from another script:</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">uw.like.roi_save</span> <span class="kn">import</span> <span class="n">load</span>
<span class="n">roi</span><span class="o">=</span><span class="n">load</span><span class="p">(</span><span class="s">&#39;roi.dat&#39;</span><span class="p">)</span>
<span class="c">## play with it some more</span>
<span class="o">...</span></code></pre></div>

<p>This loading and saving functionality can be very useful for iterative analyses.</p>

<h2 id="extended-sources">Extended Sources</h2>

<p>Pointlike can natively support spatially-extended sources. Pointlike supports the Disk, Gaussian, EllipticalDisk, EllipticalGaussian, SpatialMap, and <a href="http://en.wikipedia.org/wiki/Navarro%E2%80%93Frenk%E2%80%93White_profile">NFW</a> spatial models.</p>

<p>The <a href="http://fermi.gsfc.nasa.gov/ssc/data/analysis/scitools/source_models.html">gtlike-style XML format</a> for defining an extended source is straightforward:</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="o">&lt;</span><span class="n">source</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;ic443&quot;</span> <span class="nb">type</span><span class="o">=</span><span class="s">&quot;DiffuseSource&quot;</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">spectrum</span> <span class="nb">type</span><span class="o">=</span><span class="s">&quot;PowerLaw2&quot;</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">parameter</span> <span class="n">free</span><span class="o">=</span><span class="s">&quot;1&quot;</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;Integral&quot;</span> <span class="n">scale</span><span class="o">=</span><span class="s">&quot;1.0&quot;</span> <span class="n">value</span><span class="o">=</span><span class="s">&quot;3e-7&quot;</span> <span class="o">/&gt;</span>
    <span class="o">&lt;</span><span class="n">parameter</span> <span class="n">free</span><span class="o">=</span><span class="s">&quot;1&quot;</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;Index&quot;</span> <span class="n">scale</span><span class="o">=</span><span class="s">&quot;1.0&quot;</span> <span class="n">value</span><span class="o">=</span><span class="s">&quot;-2&quot;</span> <span class="o">/&gt;</span>
    <span class="o">&lt;</span><span class="n">parameter</span> <span class="n">free</span><span class="o">=</span><span class="s">&quot;0&quot;</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;LowerLimit&quot;</span> <span class="n">scale</span><span class="o">=</span><span class="s">&quot;1.0&quot;</span> <span class="n">value</span><span class="o">=</span><span class="s">&quot;200&quot;</span> <span class="o">/&gt;</span>
    <span class="o">&lt;</span><span class="n">parameter</span> <span class="n">free</span><span class="o">=</span><span class="s">&quot;0&quot;</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;UpperLimit&quot;</span> <span class="n">scale</span><span class="o">=</span><span class="s">&quot;1.0&quot;</span> <span class="n">value</span><span class="o">=</span><span class="s">&quot;1e6&quot;</span> <span class="o">/&gt;</span>
  <span class="o">&lt;/</span><span class="n">spectrum</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">spatialModel</span> <span class="nb">type</span><span class="o">=</span><span class="s">&quot;Gaussian&quot;</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">parameter</span> <span class="n">free</span><span class="o">=</span><span class="s">&quot;1&quot;</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;RA&quot;</span> <span class="n">scale</span><span class="o">=</span><span class="s">&quot;1.0&quot;</span> <span class="n">value</span><span class="o">=</span><span class="s">&quot;94.3124&quot;</span> <span class="o">/&gt;</span>
    <span class="o">&lt;</span><span class="n">parameter</span> <span class="n">free</span><span class="o">=</span><span class="s">&quot;1&quot;</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;DEC&quot;</span> <span class="n">scale</span><span class="o">=</span><span class="s">&quot;1.0&quot;</span> <span class="n">value</span><span class="o">=</span><span class="s">&quot;22.5745&quot;</span> <span class="o">/&gt;</span>
    <span class="o">&lt;</span><span class="n">parameter</span> <span class="n">free</span><span class="o">=</span><span class="s">&quot;1&quot;</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;Sigma&quot;</span> <span class="n">scale</span><span class="o">=</span><span class="s">&quot;1.0&quot;</span> <span class="n">value</span><span class="o">=</span><span class="s">&quot;0.18&quot;</span> <span class="o">/&gt;</span>
  <span class="o">&lt;/</span><span class="n">spatialModel</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">source</span><span class="o">&gt;</span></code></pre></div>

<p>To fit the extension parameters of an extended source:</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">roi</span><span class="o">.</span><span class="n">fit_extension</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="s">&quot;name&quot;</span><span class="p">)</span></code></pre></div>

<p>This produces the output</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">center</span> <span class="o">=</span> <span class="p">[</span> <span class="mf">258.390</span><span class="n">d</span><span class="p">,</span> <span class="o">-</span><span class="mf">39.760</span><span class="n">d</span> <span class="p">],</span> <span class="n">ext</span> <span class="o">=</span> <span class="p">[</span> <span class="mf">0.500</span><span class="n">d</span> <span class="p">],</span> <span class="n">logL</span> <span class="o">=</span> <span class="mf">31019.772</span><span class="p">,</span> <span class="n">dlogL</span><span class="o">=</span><span class="mf">0.00</span>
 <span class="o">**********</span>
 <span class="o">**</span>    <span class="mi">1</span> <span class="o">**</span><span class="n">SET</span> <span class="n">PRINT</span>           <span class="mi">1</span>
 <span class="o">**********</span>
 <span class="o">**********</span>
 <span class="o">**</span>    <span class="mi">2</span> <span class="o">**</span><span class="n">SET</span> <span class="n">STR</span>            <span class="mi">1</span>
 <span class="o">**********</span>
 <span class="n">NOW</span> <span class="n">USING</span> <span class="n">STRATEGY</span>  <span class="mi">1</span><span class="p">:</span> <span class="n">TRY</span> <span class="n">TO</span> <span class="n">BALANCE</span> <span class="n">SPEED</span> <span class="n">AGAINST</span> <span class="n">RELIABILITY</span>
 <span class="n">PARAMETER</span> <span class="n">DEFINITIONS</span><span class="p">:</span>
    <span class="n">NO</span><span class="o">.</span>   <span class="n">NAME</span>         <span class="n">VALUE</span>      <span class="n">STEP</span> <span class="n">SIZE</span>      <span class="n">LIMITS</span>
     <span class="mi">1</span> <span class="n">RA</span>           <span class="mf">2.58390e+02</span>  <span class="mf">1.00000e-01</span>    <span class="mf">2.48390e+02</span>  <span class="mf">2.68390e+02</span>
     <span class="mi">2</span> <span class="n">Dec</span> <span class="p">(</span><span class="n">rotated</span><span class="p">)</span>   <span class="mf">0.00000e+00</span>  <span class="mf">1.00000e-01</span>   <span class="o">-</span><span class="mf">1.00000e+01</span>  <span class="mf">1.00000e+01</span>
     <span class="mi">3</span> <span class="n">log10</span><span class="p">(</span><span class="n">Sigma</span><span class="p">)</span>  <span class="o">-</span><span class="mf">3.01030e-01</span>  <span class="mf">4.00000e-02</span>   <span class="o">-</span><span class="mf">1.00000e+01</span>  <span class="mf">4.77121e-01</span>
 <span class="o">**********</span>
 <span class="o">**</span>    <span class="mi">3</span> <span class="o">**</span><span class="n">SET</span> <span class="n">ERRDEF</span>         <span class="mf">0.5</span>
 <span class="o">**********</span>
 <span class="o">**********</span>
 <span class="o">**</span>    <span class="mi">4</span> <span class="o">**</span><span class="n">SIMPLEX</span>          <span class="mi">500</span>        <span class="mf">0.05</span>
 <span class="o">**********</span>
 <span class="n">FIRST</span> <span class="n">CALL</span> <span class="n">TO</span> <span class="n">USER</span> <span class="n">FUNCTION</span> <span class="n">AT</span> <span class="n">NEW</span> <span class="n">START</span> <span class="n">POINT</span><span class="p">,</span> <span class="n">WITH</span> <span class="n">IFLAG</span><span class="o">=</span><span class="mf">4.</span>
<span class="n">center</span> <span class="o">=</span> <span class="p">[</span> <span class="mf">258.390</span><span class="n">d</span><span class="p">,</span> <span class="o">-</span><span class="mf">39.760</span><span class="n">d</span> <span class="p">],</span> <span class="n">ext</span> <span class="o">=</span> <span class="p">[</span> <span class="mf">0.500</span><span class="n">d</span> <span class="p">],</span> <span class="n">logL</span> <span class="o">=</span> <span class="mf">31019.772</span><span class="p">,</span> <span class="n">dlogL</span><span class="o">=</span><span class="mf">0.00</span>
 <span class="n">START</span> <span class="n">SIMPLEX</span> <span class="n">MINIMIZATION</span><span class="o">.</span>    <span class="n">CONVERGENCE</span> <span class="n">WHEN</span> <span class="n">EDM</span> <span class="o">.</span><span class="n">LT</span><span class="o">.</span> <span class="mf">0.05</span>
<span class="n">center</span> <span class="o">=</span> <span class="p">[</span> <span class="mf">258.520</span><span class="n">d</span><span class="p">,</span> <span class="o">-</span><span class="mf">39.760</span><span class="n">d</span> <span class="p">],</span> <span class="n">ext</span> <span class="o">=</span> <span class="p">[</span> <span class="mf">0.500</span><span class="n">d</span> <span class="p">],</span> <span class="n">logL</span> <span class="o">=</span> <span class="mf">31018.118</span><span class="p">,</span> <span class="n">dlogL</span><span class="o">=-</span><span class="mf">1.65</span>
<span class="o">...</span>
<span class="n">setting</span> <span class="n">source</span> <span class="n">to</span> <span class="n">best</span> <span class="n">fit</span> <span class="n">parameters</span>
<span class="n">center</span> <span class="o">=</span> <span class="p">[</span> <span class="mf">258.461</span><span class="n">d</span><span class="p">,</span> <span class="o">-</span><span class="mf">39.907</span><span class="n">d</span> <span class="p">],</span> <span class="n">ext</span> <span class="o">=</span> <span class="p">[</span> <span class="mf">0.551</span><span class="n">d</span> <span class="p">],</span> <span class="n">logL</span> <span class="o">=</span> <span class="mf">31024.697</span><span class="p">,</span> <span class="n">dlogL</span><span class="o">=</span><span class="mf">4.92</span></code></pre></div>

<p>To compute the extension significance of an extended source:</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">ts_ext</span><span class="o">=</span><span class="n">roi</span><span class="o">.</span><span class="n">TS_ext</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="s">&quot;name&quot;</span><span class="p">)</span></code></pre></div>

<p>To create an extended source directly from python:</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">uw.like.SpatialModels</span> <span class="kn">import</span> <span class="o">*</span>
<span class="n">center</span><span class="o">=</span><span class="n">SkyDir</span><span class="p">(</span><span class="mi">178</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="n">SkyDir</span><span class="o">.</span><span class="n">GALACTIC</span><span class="p">)</span>

<span class="n">Disk</span><span class="p">(</span><span class="n">sigma</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span><span class="n">center</span><span class="o">=</span><span class="n">center</span><span class="p">)</span>
<span class="n">NFW</span><span class="p">(</span><span class="n">sigma</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">center</span><span class="o">=</span><span class="n">center</span><span class="p">)</span>
<span class="n">Gaussain</span><span class="p">(</span><span class="n">sigma</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span><span class="n">center</span><span class="o">=</span><span class="n">center</span><span class="p">)</span>
<span class="n">EllipticalDisk</span><span class="p">(</span><span class="n">major_axis</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span>
               <span class="n">minor_axis</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">pos_angle</span><span class="o">=</span><span class="mi">45</span><span class="p">,</span>
               <span class="n">center</span><span class="o">=</span><span class="n">center</span><span class="p">)</span>
<span class="n">EllipticalGaussian</span><span class="p">(</span><span class="n">major_axis</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span>
                  <span class="n">minor_axis</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">pos_angle</span><span class="o">=</span><span class="mi">45</span><span class="p">,</span>
                 <span class="n">center</span><span class="o">=</span><span class="n">center</span><span class="p">)</span>
<span class="n">SpatialMap</span><span class="p">(</span><span class="nb">file</span><span class="o">=</span><span class="s">&#39;template.fits)</span></code></pre></div>

<p>To create a new extended source:</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">uw.like.roi_extended</span> <span class="kn">import</span> <span class="n">ExtendedSource</span>
<span class="kn">from</span> <span class="nn">uw.like.Models</span> <span class="kn">import</span> <span class="n">PowerLaw</span>
<span class="kn">from</span> <span class="nn">uw.like.SpatialModels</span> <span class="kn">import</span> <span class="n">Disk</span>

<span class="n">spatial</span><span class="o">=</span><span class="n">Disk</span><span class="p">(</span><span class="n">sigma</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">center</span><span class="o">=</span><span class="n">SkyDir</span><span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">SkyDir</span><span class="o">.</span><span class="n">GALACTIC</span><span class="p">))</span>

<span class="n">spectral</span><span class="o">=</span><span class="n">PowerLaw</span><span class="p">(</span><span class="n">norm</span><span class="o">=</span><span class="mf">1e-11</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

<span class="n">es</span><span class="o">=</span><span class="n">ExtendedSource</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;extended source&#39;</span><span class="p">,</span>
                  <span class="n">spatial_model</span><span class="o">=</span><span class="n">spatial</span><span class="p">,</span>
                  <span class="n">model</span><span class="o">=</span><span class="n">spectral</span><span class="p">)</span></code></pre></div>

<p>To add the extended source to the ROI:</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">roi</span><span class="o">.</span><span class="n">add_source</span><span class="p">(</span><span class="n">es</span><span class="p">)</span></code></pre></div>

<p>To modify a source’s spatial model:</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">roi</span><span class="o">.</span><span class="n">modify</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="s">&#39;extended_source&#39;</span><span class="p">,</span>
           <span class="n">spatial_model</span><span class="o">=</span><span class="n">Disk</span><span class="p">(</span><span class="n">sigma</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">center</span><span class="o">=</span><span class="n">SkyDir</span><span class="p">(</span><span class="o">...</span><span class="p">))</span></code></pre></div>

<p>To convert a point source into an extended source:</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">roi</span><span class="o">.</span><span class="n">modify</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="s">&#39;point_source&#39;</span><span class="p">,</span> <span class="n">spatial_model</span><span class="o">=...</span><span class="p">)</span></code></pre></div>

<p>To convert an extended source into a point source:</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">roi</span><span class="o">.</span><span class="n">modify</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="s">&#39;extended_source&#39;</span><span class="p">,</span> <span class="n">skydir</span><span class="o">=...</span><span class="p">)</span></code></pre></div>

<h2 id="references">References</h2>

<p>If you would like to learn more about pointlike:</p>

<ul>
  <li>There is additional documentation about pointlike on the <a href="http://glast-ground.slac.stanford.edu/workbook/pages/sciTools_pointlike_tutorial/2_pointlike_tutorial_part01.html">LAT workbook</a>.</li>
  <li><a href="http://arxiv.org/abs/1101.6072">Matthew Kerr’s PhD Thesis</a> describes the implementation details of pointlike.</li>
  <li>The extended source functionality of pointlike is described in <a href="http://arxiv.org/abs/1207.0027">this publication</a>.</li>
  <li>You can view the pointlike source code <a href="http://www-glast.stanford.edu/cgi-bin/viewcvs/pointlike/python/uw">here</a>.</li>
</ul>

<p>If you have any questions or comments, please post them below. If
you liked this post, you can
<a href="https://twitter.com/intent/tweet?url=http://www.joshualande.com/pointlike-fitting-package&amp;text=The pointlike Maximum-likelihood Fitting Package For Analysis Fermi-LAT Data&amp;via=joshualande" target="_blank">
  share it with your followers</a> 
or 
<a href="https://twitter.com/joshualande">
  follow me on Twitter</a>!</p>


  </div>
  
</div>

<div class="pagination">
  
    <span class="pagination-item older">Older</span>
  
  
    
      <a class="pagination-item newer" href="/page16/">Newer</a>
    
  
</div>


      



      <div class="footer">
        <p>
          &copy; 2015. All rights reserved.
        </p>
      </div>
    </div>

  </body>
</html>
